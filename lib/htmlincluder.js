!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=e.wrapFiles={},r=e.insertFiles={},i=e.pageFiles=[],a=e.options={};e.devOptions={},e.insertPattern=void 0,e.filePathAttribute=void 0,e.jsonPathAttribute=void 0,e.configureFiles=function(t){"_"===t.name[0]?o[t.path]=t:"-"===t.name[0]?r[t.path]=t:i.push(t)},e.setOptions=function(t){e.devOptions=t.dev||{},e.options=a=t,e.insertPattern=a.insertPattern?"\x3c!--#"+a.insertPattern:"\x3c!--#insert",e.filePathAttribute=a.filePathAttribute?a.filePathAttribute:"path",e.jsonPathAttribute=a.jsonPathAttribute?a.jsonPathAttribute:"jsonPath"}},function(t,e,n){"use strict";var o=n(0),r=n(2);t.exports={initialize:function(t){return(0,o.setOptions)(t)},hashFile:function(t){var e=a(t);s(e),(0,o.configureFiles)(e)},buildFileResult:function(t){return o.pageFiles.map(function(e){var n=(0,r.processFile)(e,o.options.jsonInput||{});return e.content=n.content,e.processed=!0,t&&t(e),e})}};var i=/^win/.test(process.platform),a=function(t){var e={path:t.path,content:t.contents.toString("utf8").trim(),processed:!1,file:t};return e.name=i?t.path.split("\\"):t.path.split("/"),e.name=e.name[e.name.length-1],e},s=function(t){if(t.content.indexOf("\x3c!--#clipbefore")>-1&&(t.content=t.content.split(/<!--#clipbefore\s*-->/).splice(1)[0].split("\x3c!--#clipafter").splice(0,1)[0]),t.content.indexOf("\x3c!--#clipbetween")>-1){var e=t.content.split(/<!--#clipbetween\s*-->/);t.content=e[0]+e[1].split(/<!--#endclipbetween\s*-->/)[1]}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.processFile=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},_config=__webpack_require__(0),getDefaultNode=function(){return{type:"",file:{},originalContent:"",content:"",parent:{},innerScope:null,children:[],nestedNodes:[],attributes:{}}},processFile=exports.processFile=function(t,e,n,o){var r=_extends({},getDefaultNode(),{type:"topNode",file:t,originalContent:t.content,content:t.content},n?{parent:n}:{},o?{innerScope:o}:{});return-1===r.originalContent.indexOf("\x3c!--#")?r:(processNode(r,e),r)},processNode=function(t,e){if("textContent"!==t.type){var n=splitContent(t.content).filter(function(t){return""!==t});t.nestedNodes=buildNodes(t,n,e),resolveNode(t,e)}},buildNodes=function t(e,n,o,r){for(var i=[];n.length>0;){var a=n.shift();if(r&&0===a.indexOf(r))return i;var s=findNodeType(a),c=_extends({},getDefaultNode(),{type:s,parent:e,file:e.file,innerScope:e.innerScope,originalContent:a,content:a});"textContent"!==s?(c.content=c.originalContent.slice(1),c.children="wrap"===s?t(c,n,o,"\x3c!--#endwrap"):"each"===s?t(c,n,o,"\x3c!--#endeach"):"if"===s?t(c,n,o,"\x3c!--#endif"):[],i.push(c)):i.push(c)}return r&&console.warn("WARNING while processing file '"+e.file.path+"': there is a missing tag"),i},resolveNode=function(t,e){t.nestedNodes.length>0&&(t.nestedNodes.forEach(function(t){return processNode(t,e)}),t.content=joinContent(t.nestedNodes));var n=nodeProcessors[t.type];n?(t.attributes=loadNodeAttributes(t),n(t,e)):console.warn("WARNING while processing file '"+t.file.path+"': there is no processor for type '"+t.type+"'")},loadNodeAttributes=function(t){return(nodeAttributes[t.type]||[]).reduce(function(e,n){if(hasTagAttribute(n,t.originalContent)){var o=getTagAttribute(n,t.originalContent);e[n]="rawJson"===n?processRawJson(o):o}return e},{})},findNodeType=function(t){return 0===t.indexOf("\x3c!--#insert")?"insert":0===t.indexOf("\x3c!--#data")?"data":0===t.indexOf("\x3c!--#jsonInsert")?"jsonInsert":0===t.indexOf("\x3c!--#wrap")?"wrap":0===t.indexOf("\x3c!--#middle")?"middle":0===t.indexOf("\x3c!--#each")?"each":0===t.indexOf("\x3c!--#if")?"if":"textContent"},joinContent=function(t){return t.map(function(t){return t.content}).join("")},nodeProcessors={topNode:function(t,e){return t.content=joinContent(t.nestedNodes)},textContent:function(t,e){return console.warn("WARNING: Why are we processing a textContent?")},insert:function(t,e){var n=t.file,o=t.innerScope,r=t.attributes,i=r.path,a=r.jsonPath,s=r.rawJson;if(!i)return console.warn("WARNING while processing file '"+n.path+"': insert tag with no path attribute"),void(t.content="");var c=buildPathFromRelativePath(n.path,i);if(!_config.insertFiles[c])return console.warn("WARNING while processing file '"+n.path+"': insert file '"+c+"' does not exist"),void(t.content="");var u=_extends({},_config.insertFiles[c]),f=s&&a?getDataFromJsonPath(a,s):o&&a?getDataFromJsonPath(a,o):s||(a?getDataFromJsonPath(a,e):void 0),l=processFile(u,e,t,f);t.content=l.content},wrap:function(t,e){var n=t.file,o=t.innerScope,r=t.attributes,i=r.path,a=r.jsonPath,s=r.rawJson;if(!i)return console.warn("WARNING while processing file '"+t.file.path+"': wrap tag with no path attribute"),void(t.content="");var c=buildPathFromRelativePath(n.path,i);if(!_config.wrapFiles[c])return console.warn("WARNING while processing file '"+t.file.path+"': wrap file '"+c+"' does not exist"),void(t.content="");t.children.forEach(function(t){return processNode(t,e)}),t.content=joinContent(t.children);var u=_extends({},_config.wrapFiles[c]),f=s&&a?getDataFromJsonPath(a,s):o&&a?getDataFromJsonPath(a,o):s||(a?getDataFromJsonPath(a,e):void 0),l=processFile(u,e,t,f);t.content=l.content},middle:function(t,e){return t.content=t.parent.parent.content},data:function(t,e){var n=t.innerScope,o=t.file,r=t.attributes,i=r.jsonPath,a=r.rawJson,s=t.attributes.default;if(!i||!a&&!n&&!s)return console.warn("WARNING while processing file '"+o.path+"': data tag with no data to look up for content '"+t.originalContent+"'"),void(t.content="");var c=getDataFromJsonPath(i,a||n);t.content=c||s||""},jsonInsert:function(t,e){var n=t.attributes.jsonPath,o=t.attributes.default;if(n){var r=getDataFromJsonPath(n,e);t.content=r||o||""}else t.content=""},each:function(t,e){var n=t.file,o=t.innerScope,r=t.attributes,i=r.count,a=r.jsonPath,s=r.rawJson;if(!(i||a||Array.isArray(s)||Array.isArray(o)))return console.warn("WARNING while processing file '"+n.path+"': each tag with attribute problems: count, jsonPath and rawJson and innerScope are not arrays"),void(t.content="");var c=s||t.innerScope||e,u=a?getDataFromJsonPath(a,c):void 0,f=Array.isArray(c)?c:Array.isArray(u)?u:void 0;if(f||i){for(var l=[],p=function(n){var o=t.children.map(function(t){return _extends({},t,f?{innerScope:"object"===_typeof(f[n])?_extends({},f[n]):f[n]}:{})});o.forEach(function(t){return processNode(t,e)}),l.push(joinContent(o))},d=0;(!i||i&&d<i)&&(!f||f&&d<f.length);d++)p(d);t.content=l.join("")}else t.content=""},if:function(t,e){var n=t.innerScope,o=t.attributes,r=o.jsonPath,i=o.rawJson;r?getDataFromJsonPath(r,i||n||e)?(t.children.forEach(function(n){n.innerScope=_extends({},t.innerScope),processNode(n,e)}),t.content=joinContent(t.children)):t.content="":t.content=""}},nodeAttributes={insert:["path","jsonPath","rawJson"],data:["jsonPath","rawJson","default"],jsonInsert:["jsonPath","default"],wrap:["path","jsonPath","rawJson"],middle:[],each:["count","jsonPath","rawJson"],if:["jsonPath","rawJson"],textContent:[]},splitContent=function(t,e){var n=[],o=-1,r="",i=e||"\x3c!--#";if(-1===(o=t.indexOf(i)))return[t];for(;o>-1;){(r=t.slice(0,o))&&n.push(r),t=t.slice(o);var a=getIndexOfClosingBrace(t,i,"--\x3e");r=t.slice(0,a),n.push(r),-1===(o=(t=t.slice(a)).indexOf(i))&&n.push(t)}return n},getIndexOfClosingBrace=function(t,e,n){var o=0,r=t.substr(1),i=r.indexOf(n),a=r.indexOf(e);if(-1===i&&console.trace("No Close tag for startPattern: "+e+" and endPattern: "+n+" and content: "+t),-1===a||a>i)return i+4;a+=1,i+=1;do{var s=void 0,c=void 0;if(a>-1&&a<i)(s=r.substr(a).indexOf(e))>-1?(a+=s+2,o+=1):a=-1;else if((c=r.substr(i).indexOf(n))>-1){if(i+=c+1,0===(o-=1))return i+3}else if(o>0){console.error("ERROR: there is an unclosed tag - content is "+t);break}}while(o>0);return-1===(i+=4)&&console.error("ERROR: no closing tag! you are missing a '"+n+"'"),i},getDataFromJsonPath=function(t,e){if("this"===t)return e;var n=t.split(".").reduce(function(t,e){return t?t[e]:""},e);return Array.isArray(n)||"object"!==(void 0===n?"undefined":_typeof(n))||(n=toSafeJsonString(n)),n},isWin=/^win/.test(process.platform),fixFilePathForOS=function(t){return isWin?t.replace(/\//g,"\\"):t.replace(/\\/g,"/")},buildPathFromRelativePath=function(t,e){var n=isWin?"\\":"/",o=t.split(n);return o.pop(),(e=fixFilePathForOS(e)).split(n).forEach(function(t){".."===t?o.pop():"."!==t&&""!==t&&o.push(t)}),o=o.join(n)},toSafeJsonString=function(t){return JSON.stringify(t).replace(/\'/g,"\\'").replace(/"/g,"'")},processRawJson=function processRawJson(jsonString){"object"===(void 0===jsonString?"undefined":_typeof(jsonString))&&(jsonString=toSafeJsonString(jsonString));var jsonData={};try{eval("jsonData = "+jsonString)}catch(t){console.error("ERROR: Poorly formatted rawJson string:\n      "+jsonString+"\n      This must be valid JavaScript.\n    ")}return jsonData},hasTagAttribute=function(t,e){return e.indexOf(t+'="')>-1},getTagAttribute=function(t,e){var n,o;return-1===(n=e.indexOf(t+'="'))?(console.warn("Warning: no tag of name `"+t+"` found in the following content: `"+e+"`"),""):(o=(e=e.slice(n+t.length+2)).indexOf('"'),e=e.slice(0,o))}}]));
//# sourceMappingURL=htmlincluder.js.map